<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT Processor | Viralio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = { theme: { extend: { colors: { primary: '#6366f1', dark: '#030712' } } } }
    </script>
    <style>
        body { background-color: #030712; color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body class="p-6 md:p-12 relative overflow-hidden min-h-screen">
    
    <div class="absolute top-0 right-1/4 w-96 h-96 bg-red-500/10 rounded-full blur-[120px] pointer-events-none"></div>

    <a href="/" class="text-gray-400 hover:text-white mb-8 inline-flex items-center gap-2 font-medium transition relative z-10">
        <i class="fas fa-arrow-left"></i> Înapoi la Dashboard
    </a>
    
    <div class="max-w-4xl mx-auto glass rounded-[2rem] p-8 md:p-12 shadow-2xl relative z-10">
        <div class="text-center mb-10">
            <div class="w-16 h-16 rounded-2xl bg-red-500/20 text-red-500 flex items-center justify-center text-3xl mx-auto mb-6">
                <i class="fab fa-youtube"></i>
            </div>
            <h1 class="text-4xl font-extrabold mb-3">YT Auto Downloader & AI</h1>
            <p class="text-gray-400 text-lg">Introdu link-ul de YouTube pentru a extrage 1080p și textul.</p>
        </div>

        <div class="relative mb-6 group">
            <div class="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none text-gray-500">
                <i class="fas fa-link"></i>
            </div>
            <input type="text" id="yt-url" placeholder="Lipește link-ul aici..." class="w-full bg-[#0f1423] border border-gray-800 rounded-2xl py-5 pl-12 pr-40 text-lg focus:outline-none focus:border-primary transition-all text-white placeholder-gray-600 shadow-inner">
            <button id="run-btn" class="absolute right-2 top-2 bottom-2 bg-primary hover:bg-indigo-500 text-white px-8 rounded-xl font-bold transition-all flex items-center gap-2 shadow-[0_0_20px_rgba(99,102,241,0.3)]">
                START <i class="fas fa-bolt"></i>
            </button>
        </div>

        <div id="loader" class="hidden text-center py-12">
            <div class="relative w-20 h-20 mx-auto mb-6">
                <div class="absolute inset-0 rounded-full border-t-2 border-primary animate-spin"></div>
                <div class="absolute inset-2 rounded-full border-r-2 border-pink-500 animate-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
                <i class="fas fa-brain absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Procesăm Magia AI...</h3>
            <p class="text-gray-500">Video și Subtitrări în curs de generare.</p>
        </div>

        <div id="result" class="hidden mt-10 space-y-6">
            <div class="bg-green-500/10 border border-green-500/30 text-green-400 p-5 rounded-2xl flex items-center gap-4">
                <i class="fas fa-check-circle text-3xl"></i>
                <div>
                    <h3 class="font-bold text-white text-lg">Gata!</h3>
                    <p class="text-sm">Fișierele tale au fost generate cu succes.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <a id="dl-video" href="#" download class="flex items-center justify-center gap-3 bg-[#0f1423] hover:bg-white/5 border border-gray-800 hover:border-gray-600 p-5 rounded-2xl font-bold transition group">
                    <i class="fas fa-video text-blue-400 text-xl group-hover:scale-110 transition"></i> MP4 1080p
                </a>
            </div>

            <div class="bg-[#0f1423] rounded-2xl p-6 border border-gray-800">
                <div class="flex items-center gap-3 mb-4 border-b border-gray-800 pb-4">
                    <div class="p-2 bg-primary/20 rounded-lg text-primary"><i class="fas fa-align-left"></i></div>
                    <h4 class="font-bold text-gray-200">Text Tradus / Rezumat</h4>
                </div>
                <p id="ai-text" class="text-sm text-gray-400 leading-relaxed font-medium whitespace-pre-wrap"></p>
            </div>
        </div>

        <p id="error-msg" class="hidden mt-6 bg-red-500/10 border border-red-500/30 text-red-400 p-4 rounded-xl text-center font-bold"></p>
    </div>

    <script>
        document.getElementById('run-btn').addEventListener('click', async () => {
            const urlInput = document.getElementById('yt-url');
            const url = urlInput.value.trim();
            
            if (!url) return alert('Te rog introdu un link valid!');

            const btn = document.getElementById('run-btn');
            const loader = document.getElementById('loader');
            const result = document.getElementById('result');
            const errorMsg = document.getElementById('error-msg');

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            loader.classList.remove('hidden');
            result.classList.add('hidden');
            errorMsg.classList.add('hidden');

            try {
                // Am setat linkul curat catre propriul domeniu. 
                // Nu mai exista erori de SSL sau CORS asa!
                const backendUrl = '/api/process-yt';
                
                const res = await fetch(backendUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const responseText = await res.text();
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    throw new Error("Timpul de așteptare a expirat. Proxy-ul s-a mișcat prea greu.");
                }

                if (!res.ok) throw new Error(data.error || "Eroare necunoscută la server.");

                document.getElementById('dl-video').href = data.downloadUrl;
                document.getElementById('ai-text').innerText = data.aiSummary;
                
                result.classList.remove('hidden');
            } catch (err) {
                errorMsg.innerText = "Eroare: " + err.message;
                errorMsg.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'START <i class="fas fa-bolt"></i>';
                loader.classList.add('hidden');
            }
        });
    </script>
</body>
</html>